<div class="match-setup-container">
  <div class="setup-card">
    <div class="header">
      <h1>🏏 Match Setup</h1>
      <p>Configure teams, overs, and toss before starting the match</p>
    </div>

    <form [formGroup]="setupForm" class="setup-form">
      <!-- Match Configuration -->
      <div class="config-section">
        <h3>Match Configuration</h3>
        <div class="form-row">
          <div class="form-group">
            <label for="overs">Number of Overs</label>
            <select id="overs" formControlName="overs">
              <option *ngFor="let over of oversOptions" [value]="over">{{ over }} Overs</option>
            </select>
          </div>
        </div>
      </div>

      <!-- Team Setup -->
      <div class="teams-section">
        <h3>Team Setup</h3>
        
        <!-- Team A -->
        <div class="team-card">
          <div class="team-header">
            <h4>Team A</h4>
            <input 
              type="text" 
              formControlName="teamAName" 
              placeholder="Team A Name"
              class="team-name-input"
            >
          </div>
          
          <div class="players-section">
            <div class="add-player">
              <input 
                type="text" 
                #teamAPlayer 
                placeholder="Add player name"
                (keyup.enter)="addPlayerToTeam('A', teamAPlayer.value); teamAPlayer.value = ''"
              >
              <button type="button" (click)="addPlayerToTeam('A', teamAPlayer.value); teamAPlayer.value = ''">
                Add
              </button>
            </div>
            
            <div class="registered-players" *ngIf="getAvailablePlayers('A').length > 0">
              <label>Or select from registered players:</label>
              <div class="player-chips">
                <span 
                  *ngFor="let player of getAvailablePlayers('A')" 
                  class="player-chip"
                  (click)="addRegisteredPlayerToTeam('A', player)"
                >
                  {{ player.name }}
                </span>
              </div>
            </div>
            
            <div class="current-players">
              <div 
                *ngFor="let player of teamA.players" 
                class="player-item"
              >
                <span>{{ player.name }}</span>
                <button 
                  type="button" 
                  class="remove-btn"
                  (click)="removePlayerFromTeam('A', player.id)"
                >
                  ✕
                </button>
              </div>
            </div>
            
            <div class="player-count">
              {{ teamA.players.length }}/7 players
            </div>
          </div>
        </div>

        <!-- Team B -->
        <div class="team-card">
          <div class="team-header">
            <h4>Team B</h4>
            <input 
              type="text" 
              formControlName="teamBName" 
              placeholder="Team B Name"
              class="team-name-input"
            >
          </div>
          
          <div class="players-section">
            <div class="add-player">
              <input 
                type="text" 
                #teamBPlayer 
                placeholder="Add player name"
                (keyup.enter)="addPlayerToTeam('B', teamBPlayer.value); teamBPlayer.value = ''"
              >
              <button type="button" (click)="addPlayerToTeam('B', teamBPlayer.value); teamBPlayer.value = ''">
                Add
              </button>
            </div>
            
            <div class="registered-players" *ngIf="getAvailablePlayers('B').length > 0">
              <label>Or select from registered players:</label>
              <div class="player-chips">
                <span 
                  *ngFor="let player of getAvailablePlayers('B')" 
                  class="player-chip"
                  (click)="addRegisteredPlayerToTeam('B', player)"
                >
                  {{ player.name }}
                </span>
              </div>
            </div>
            
            <div class="current-players">
              <div 
                *ngFor="let player of teamB.players" 
                class="player-item"
              >
                <span>{{ player.name }}</span>
                <button 
                  type="button" 
                  class="remove-btn"
                  (click)="removePlayerFromTeam('B', player.id)"
                >
                  ✕
                </button>
              </div>
            </div>
            
            <div class="player-count">
              {{ teamB.players.length }}/7 players
            </div>
          </div>
        </div>
      </div>

      <!-- Toss Section -->
      <div class="toss-section">
        <h3>Toss</h3>
        
        <div class="toss-content" *ngIf="!showTossResult">
          <p>Click the button below to flip the toss</p>
          <button type="button" class="toss-btn" (click)="flipToss()">
            🪙 Flip Toss
          </button>
        </div>
        
        <div class="toss-result" *ngIf="showTossResult">
          <div class="result-card">
            <h4>🎯 Toss Result</h4>
            <p><strong>{{ tossWinner }}</strong> won the toss</p>
            <p>and chose to <strong>bat first</strong></p>
          </div>
          
          <div class="form-group">
            <label for="battingFirst">Who bats first?</label>
            <select id="battingFirst" formControlName="battingFirst">
              <option [value]="teamA.name">{{ teamA.name }}</option>
              <option [value]="teamB.name">{{ teamB.name }}</option>
            </select>
          </div>
        </div>
      </div>

      <!-- Start Match Button -->
      <div class="start-section">
        <button 
          type="button" 
          class="start-btn" 
          [disabled]="!canStartMatch() || isLoading"
          (click)="startMatch()"
        >
          <span *ngIf="!isLoading">🚀 Start Match</span>
          <span *ngIf="isLoading">Starting Match...</span>
        </button>
        
        <div class="requirements" *ngIf="!canStartMatch()">
          <p>⚠️ Requirements to start match:</p>
          <ul>
            <li [class.met]="teamA.players.length >= 5">Team A: At least 5 players ({{ teamA.players.length }}/5)</li>
            <li [class.met]="teamB.players.length >= 5">Team B: At least 5 players ({{ teamB.players.length }}/5)</li>
            <li [class.met]="showTossResult">Toss completed</li>
          </ul>
        </div>
      </div>
    </form>
  </div>
</div>
